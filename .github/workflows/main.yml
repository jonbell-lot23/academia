name: End-to-end tests

on:
  push:
  pull_request:
  schedule:
    - cron: '5 17 * * *' # Every day at 5:05 AM NZ
  workflow_dispatch:

jobs:
  cypress-run:
    env:
      DATABASE_URL: ${{ secrets.DATABASE_URL }}
    runs-on: ubuntu-22.04    
    steps:
    - name: Checkout
      uses: actions/checkout@v3    
    - name: Cypress run
      uses: cypress-io/github-action@v5.1.0
      with:
        browser: replay-chromium
        build: npm run build
        start: npm start
      env:
        REPLAY_API_KEY: ${{ secrets.RECORD_REPLAY_API_KEY }}
    - name: Upload replays
      if: always()
      uses: replayio/action-upload@v0.5.1
      with:
        api-key: ${{ secrets.RECORD_REPLAY_API_KEY }}
